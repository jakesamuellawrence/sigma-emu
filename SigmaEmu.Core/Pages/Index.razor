@page "/"
@using SigmaEmu.Assembler.Assembler
@using SigmaEmu.Core.Models

<Toolbar/>

<ShowSource Source="_source" LoadFileEvent="LoadFile" />

@code {

    private Source? _source;

    private async void LoadFile(IBrowserFile file)
    {
        _source = await Source.FromFileAsync(file);
        StateHasChanged();
    }

    public override Task SetParametersAsync(ParameterView parameters)
    {
        Console.WriteLine("loading");
        var (listing, errors) = Assembler.Assemble("add R21,R7,R15  \n mul R2,R0,R1 \n lea R1,6[R0] \n testVar data 10t \n");
        foreach (var line in listing.Lines)
        {
            Console.WriteLine($"{line.Address.ToHexString()} {line.Code1.ToHexString()} {line.Code2?.ToHexString()} {line.Source}");
        }
        foreach (var error in errors)
        {
            Console.WriteLine(error);
        }
        return base.SetParametersAsync(parameters);
    }

}