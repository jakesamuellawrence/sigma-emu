@page "/"
@using SigmaEmu.Assembler.Assembler
@using SigmaEmu.Core.Models
@using SigmaEmu.Models

<Toolbar OnAssemble="AssembleSource" OnLoad="LoadListing" />

<MemoryDisplay MemoryArray="_memory.MemoryArray" />

@if (_listing != null)
{
    <ListingDisplay Listing="_listing"/>
}
else
{
    <SourceDisplay Source="_source" LoadFileEvent="LoadFile" />
}

@code {

    private Source? _source;
    private Listing? _listing;

    private Memory _memory = new Memory();

    private async void LoadFile(IBrowserFile file)
    {
        _source = await Source.FromFileAsync(file);
        StateHasChanged();
    }

    private void AssembleSource()
    {
        if (_source == null) return;
        _listing = Assembler.Assemble(_source.ToString());
    }

    private void LoadListing()
    {
        if (_listing == null) return;
        _memory.LoadListing(_listing);
    }
    
}