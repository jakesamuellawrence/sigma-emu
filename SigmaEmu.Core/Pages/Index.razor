@page "/"
@using SigmaEmu.Assembler.Assembler
@using SigmaEmu.Core.Models
@using SigmaEmu.Models

<div class="d-flex flex-column w-100 h-100">
    <Toolbar OnAssemble="AssembleSource" OnLoad="LoadListing" />
    <div class="d-flex flex-row flex-grow-1 flex-shrink-1 overflow-auto">
        @if (_listing != null)
        {
            <ListingDisplay Listing="_listing"/>
        }
        else
        {
            <SourceDisplay Source="_source" LoadFileEvent="LoadFile" />
        }
        <Sidebar>
            <h3>Memory</h3>
            <div class="d-flex flex-row overflow-auto">
                <MemoryDisplay MemoryArray="_memory.MemoryArray"/>
                <div class="p-2"></div>
                <MemoryDisplay MemoryArray="_memory.MemoryArray"/>
            </div>
        </Sidebar>
    </div>
</div>



@code {

    private Source? _source;
    private Listing? _listing;

    private Memory _memory = new Memory();

    private async void LoadFile(IBrowserFile file)
    {
        _source = await Source.FromFileAsync(file);
        StateHasChanged();
    }

    private void AssembleSource()
    {
        if (_source == null) return;
        _listing = Assembler.Assemble(_source.ToString());
    }

    private void LoadListing()
    {
        if (_listing == null) return;
        _memory.LoadListing(_listing);
    }
    
}